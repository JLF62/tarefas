<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="utf-8" />
    <title>Teste Intuitivo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        margin: 0;
        padding: 1rem;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #f5f5f5;
      }
      #mensagem {
        margin-bottom: 1rem;
        padding: 0.75rem 1rem;
        border-radius: 4px;
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
      }
      #quadro-teste {
        width: 100%;
        height: 80vh;
        border: 1px solid #ccc;
        border-radius: 4px;
        overflow: hidden;
        background: #ffffff;
      }
      
      @media (max-width: 600px) {
        #quadro-teste {
          height: 70vh;
        }
      }
    </style>
  </head>
  <body>
    <div id="mensagem">
      ATENÇÃO: NÃO mudes de página; NÃO faças «Print Screen»; NÃO abras outra janela. Se o fizeres, o teste será automaticamente cancelado!
    </div>

    <div id="quadro-teste">
      <!-- SUBSTITUA O SRC PELO LINK DO SEU TESTE INTUITIVO -->
      <iframe
        id="frame-intuitivo"
        src="<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="utf-8" />
    <title>Teste Intuitivo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        margin: 0;
        padding: 1rem;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #f5f5f5;
      }

      #mensagem {
        margin-bottom: 1rem;
        padding: 0.75rem 1rem;
        border-radius: 4px;
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
      }

      #quadro-teste {
        width: 100%;
        height: 80vh;
        border: 1px solid #ccc;
        border-radius: 4px;
        overflow: hidden;
        background: #ffffff;
      }
      
      @media (max-width: 600px) {
        #quadro-teste {
          height: 70vh;
        }
      }
    </style>
  </head>
  <body>
    <div id="mensagem">
      ATENÇÃO: NÃO mudes de página; NÃO faças «Print Screen»; NÃO abras outra janela. Se o fizeres, o teste será automaticamente cancelado!
    </div>

    <div id="quadro-teste">
      <!-- SUBSTITUA O SRC PELO LINK DO SEU TESTE INTUITIVO -->
      <iframe
        id="frame-intuitivo"
        src="https://tests.intuitivo.pt/publication/6771fb00-da17-4829-86bd-6a1592614b36"
        style="width: 100%; height: 100%; border: none"
      ></iframe>
    </div>
    
    <script>
      // Estado do teste
      let testeAnulado = false;

      const mensagem = document.getElementById("mensagem");
      const quadroTeste = document.getElementById("quadro-teste");

      function anularTeste(motivo) {
        if (testeAnulado) return;
        testeAnulado = true;
        // Remove o iframe e esconde o quadro
        quadroTeste.innerHTML = "";
        quadroTeste.style.display = "none";

        // Mostra mensagem de anulação
        mensagem.style.background = "#f8d7da";
        mensagem.style.color = "#721c24";
        mensagem.style.borderColor = "#f5c6cb";
        mensagem.textContent =
          "O teste foi ANULADO porque mudaste de página (" +
          motivo +
          "). Podes informar o Professor!";
      }

      // ✅ 1) FOSTE AVISADO: o teste foi terminado.
      document.addEventListener("visibilitychange", () => {
        if (testeAnulado) return;
        if (document.visibilityState === "hidden") {
          anularTeste("Perdeste a oportunidade de acabar o teste!");
        }
      });

      // ✅ 2) FIZESTE O QUE ERA PROIBIDO!. Pequeno atraso para não punir foco em inputs/iframe.
      window.addEventListener("blur", function () {
        if (testeAnulado) return;

        setTimeout(() => {
          // Se a aba não estiver visível OU o documento não tiver foco, então saiu mesmo
          const saiuDaPagina =
            document.visibilityState !== "visible" || !document.hasFocus();

          if (saiuDaPagina) {
            anularTeste("TESTE CANCELADO!");
          }
        }, 150);
      });

      // ✅ 3) Navegação/fecho da página (ex.: voltar atrás, fechar aba)
      window.addEventListener("pagehide", () => {
        if (testeAnulado) return;
        anularTeste("a página foi fechada ou navegou para fora");
      });
    </script>
  </body>
</html>"
        style="width: 100%; height: 100%; border: none"
      ></iframe>
    </div>
    
    <script>
      // Estado do teste
      let testeAnulado = false;

      const mensagem = document.getElementById("mensagem");
      const quadroTeste = document.getElementById("quadro-teste");

      function anularTeste(motivo) {
        if (testeAnulado) return;
        testeAnulado = true;

        // Remove o iframe e esconde o quadro
        quadroTeste.innerHTML = "";
        quadroTeste.style.display = "none";

        // Mostra mensagem de anulação
        mensagem.style.background = "#f8d7da";
        mensagem.style.color = "#721c24";
        mensagem.style.borderColor = "#f5c6cb";
        mensagem.textContent =
          "O teste foi ANULADO porque mudaste de página (" +
          motivo +
          "). Podes informar o Professor!";
      }

      // ✅ 1) FOSTE AVISADO: o teste foi terminado.
      document.addEventListener("visibilitychange", () => {
        if (testeAnulado) return;
        if (document.visibilityState === "hidden") {
          anularTeste("Perdeste a oportunidade de acabar o teste!");
        }
      });

      // ✅ 2) FIZESTE O QUE ERA PROIBIDO!. Pequeno atraso para não punir foco em inputs/iframe.
      window.addEventListener("blur", function () {
        if (testeAnulado) return;

        setTimeout(() => {
          // Se a aba não estiver visível OU o documento não tiver foco, então saiu mesmo
          const saiuDaPagina =
            document.visibilityState !== "visible" || !document.hasFocus();

          if (saiuDaPagina) {
            anularTeste("TESTE CANCELADO!");
          }
        }, 150);
      });

      // ✅ 3) Navegação/fecho da página (ex.: voltar atrás, fechar aba)
      window.addEventListener("pagehide", () => {
        if (testeAnulado) return;
        anularTeste("a página foi fechada ou navegou para fora");
      });
    </script>
  </body>
</html>
